(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[461],{89571:function(e,t,r){Promise.resolve().then(r.bind(r,61214))},76858:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(79205).Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},49322:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(79205).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},61649:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(79205).Z)("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]])},17689:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(79205).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},32489:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(79205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},61214:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var s=r(57437),a=r(2265),l=r(35475),n=r(27648),d=r(46221),i=r(49322),c=r(32489),o=r(79205);let x=(0,o.Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var m=r(61649),u=r(17689);let p=(0,o.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var h=r(76858);function b(){let e=(0,l.useRouter)(),t=(0,l.useSearchParams)(),[r,o]=(0,a.useState)("upload"),[b,f]=(0,a.useState)(null),[y,g]=(0,a.useState)([]),[j,v]=(0,a.useState)([]),[N,w]=(0,a.useState)([]),[k,S]=(0,a.useState)(null),[C,F]=(0,a.useState)(!1),Z=(0,a.useRef)(null),D=(0,a.useRef)(null),A=e=>{let t=e.trim().split("\n");if(t.length<2)throw Error("CSV must have at least a header and one data row");let r=t[0].split(",").map(e=>e.trim()),s=[];for(let e=1;e<t.length;e++){let a=t[e].split(","),l={};r.forEach((e,t)=>{var r;l[e]=(null===(r=a[t])||void 0===r?void 0:r.trim())||""}),s.push(l)}return s},V=e=>{let t=[];return e.forEach(e=>{let r=e.toLowerCase(),s="",a=!1;r.includes("stage")||r.includes("status")||r.includes("state")?(s="status",a=!0):r.includes("closed")||r.includes("close_date")||r.includes("won_date")?(s="closedAt",a=!1):r.includes("updated")||r.includes("modified")||r.includes("last_activity")?(s="updatedAt",a=!1):r.includes("created")||r.includes("open_date")||r.includes("start_date")||r.includes("timestamp")?(s="createdAt",a=!0):r.includes("owner")||r.includes("assigned")||r.includes("person")||r.includes("rep")?(s="ownerId",a=!1):(r.includes("value")||r.includes("amount")||r.includes("revenue")||r.includes("price"))&&(s="value",a=!1),t.push({sourceField:e,targetField:s,required:a})}),t},M=async e=>{S(null),F(!0);try{let t=await e.text();if(!t.trim())throw Error("File is empty");let r=A(t);if(0===r.length)throw Error("No data rows found");let s=Object.keys(r[0]);f(e),g(r),v(s);let a=V(s);w(a),F(!1),o("map")}catch(e){S(e instanceof Error?e.message:"Failed to parse CSV"),F(!1)}},E=async e=>{F(!0),S(null);try{let t="true"===e?"sample-data.csv":e;console.log("Loading sample CSV:",t);let r=await fetch("/".concat(t));if(!r.ok)throw Error("Failed to fetch: ".concat(r.status));let s=await r.text();console.log("CSV loaded, length:",s.length);let a=new Blob([s],{type:"text/csv"}),l=new File([a],t,{type:"text/csv"});await M(l)}catch(e){console.error("Error loading sample CSV:",e),S(e instanceof Error?e.message:"Failed to load sample CSV"),F(!1)}};(0,a.useEffect)(()=>{let e=t.get("sample");e&&0===y.length&&E(e)},[t]);let O=(e,t)=>{w(r=>r.map(r=>r.sourceField===e?{...r,targetField:t}:r))},_=()=>{let e=N.some(e=>"status"===e.targetField&&e.sourceField),t=N.some(e=>"createdAt"===e.targetField&&e.sourceField);return e&&t};return(0,s.jsxs)("div",{className:"min-h-screen bg-surface",children:[(0,s.jsx)("header",{className:"border-b border-surface-tertiary bg-surface-secondary",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-6 h-16 flex items-center justify-between",children:[(0,s.jsxs)(n.default,{href:"/",className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-lg bg-brand-950 flex items-center justify-center",children:(0,s.jsx)(d.Z,{className:"w-5 h-5 text-surface"})}),(0,s.jsx)("span",{className:"font-semibold text-lg text-text-primary",children:"ClarLens"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-text-secondary",children:["upload"===r&&(0,s.jsx)("span",{className:"text-text-primary",children:"1. Upload"}),"map"===r&&(0,s.jsx)("span",{className:"text-text-primary",children:"2. Map Fields"}),"preview"===r&&(0,s.jsx)("span",{className:"text-text-primary",children:"3. Preview"})]})]})}),(0,s.jsxs)("main",{className:"max-w-2xl mx-auto px-6 py-12",children:["upload"===r&&(0,s.jsxs)("div",{className:"animate-in",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Upload your CSV"}),(0,s.jsx)("p",{className:"text-text-secondary mb-8",children:"Drag & drop your file or click to browse. We'll detect the structure automatically."}),k&&(0,s.jsxs)("div",{className:"mb-6 p-4 bg-surface-tertiary border border-surface-tertiary rounded-lg flex items-start gap-3",children:[(0,s.jsx)(i.Z,{className:"w-5 h-5 text-brand-950 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-text-primary",children:k}),(0,s.jsx)("p",{className:"text-sm text-text-secondary mt-1",children:"Make sure your CSV has headers and at least one data row."})]}),(0,s.jsx)("button",{onClick:()=>S(null),className:"ml-auto",children:(0,s.jsx)(c.Z,{className:"w-4 h-4 text-text-tertiary"})})]}),(0,s.jsxs)("div",{ref:D,onDrop:e=>{e.preventDefault();let t=e.dataTransfer.files[0];t&&"text/csv"===t.type||t.name.endsWith(".csv")?M(t):S("Please upload a CSV file")},onDragOver:e=>{e.preventDefault()},className:"\n                border-2 border-dashed rounded-lg p-12 text-center transition-colors cursor-pointer\n                ".concat(b?"border-brand-950 bg-surface-tertiary":"border-surface-tertiary hover:border-brand-300","\n              "),onClick:()=>{var e;return null===(e=Z.current)||void 0===e?void 0:e.click()},children:[(0,s.jsx)("input",{ref:Z,type:"file",accept:".csv",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&M(r)},className:"hidden"}),C?(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)(x,{className:"w-8 h-8 text-brand-950 animate-spin"}),(0,s.jsx)("p",{className:"text-text-secondary",children:"Processing CSV..."})]}):b?(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Z,{className:"w-8 h-8 mx-auto mb-4 text-brand-950"}),(0,s.jsx)("p",{className:"font-medium text-text-primary",children:b.name}),(0,s.jsxs)("p",{className:"text-sm text-text-secondary mt-1",children:[(b.size/1024).toFixed(1)," KB â€¢ ",y.length," rows"]})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)(u.Z,{className:"w-8 h-8 mx-auto mb-4 text-text-tertiary"}),(0,s.jsx)("p",{className:"font-medium text-text-primary mb-1",children:"Drop your CSV here or click to browse"}),(0,s.jsx)("p",{className:"text-sm text-text-secondary",children:"Supports CSV files with headers"})]})]}),(0,s.jsxs)("div",{className:"mt-6 text-center",children:[(0,s.jsx)("p",{className:"text-sm text-text-tertiary mb-2",children:"Or try with sample data:"}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),console.log("Button clicked, loading sample CSV"),E("sample-data.csv")},disabled:C,className:"px-3 py-1.5 bg-surface-secondary text-text-secondary text-xs font-medium rounded-lg border border-surface-tertiary hover:bg-surface-tertiary hover:text-text-primary transition-colors disabled:opacity-50 cursor-pointer",children:C?"Loading...":"Sales Pipeline"}),(0,s.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),E("sample-sales-pipeline.csv")},disabled:C,className:"px-3 py-1.5 bg-surface-secondary text-text-secondary text-xs font-medium rounded-lg border border-surface-tertiary hover:bg-surface-tertiary hover:text-text-primary transition-colors disabled:opacity-50 cursor-pointer",children:"Sales (Extended)"}),(0,s.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),E("sample-ecommerce-orders.csv")},disabled:C,className:"px-3 py-1.5 bg-surface-secondary text-text-secondary text-xs font-medium rounded-lg border border-surface-tertiary hover:bg-surface-tertiary hover:text-text-primary transition-colors disabled:opacity-50 cursor-pointer",children:"E-commerce"}),(0,s.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),E("sample-leads.csv")},disabled:C,className:"px-3 py-1.5 bg-surface-secondary text-text-secondary text-xs font-medium rounded-lg border border-surface-tertiary hover:bg-surface-tertiary hover:text-text-primary transition-colors disabled:opacity-50 cursor-pointer",children:"Leads"})]})]})]}),"map"===r&&(0,s.jsxs)("div",{className:"animate-in",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Map your fields"}),(0,s.jsx)("p",{className:"text-text-secondary mb-6",children:"We've auto-detected your fields. Confirm the mappings below."}),(0,s.jsx)("div",{className:"mb-6 p-4 bg-surface-secondary border border-brand-600/20 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-text-secondary",children:[(0,s.jsx)("span",{className:"font-medium text-text-primary",children:"Required:"})," Stage/Status, Date (created or updated)",(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"font-medium text-text-primary",children:"Optional:"})," Owner, Value"]})}),(0,s.jsxs)("div",{className:"border border-brand-600/20 rounded-lg overflow-hidden mb-8",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 p-4 bg-surface-secondary text-sm font-medium text-text-secondary border-b border-brand-600/20",children:[(0,s.jsx)("div",{children:"Source Field"}),(0,s.jsx)("div",{children:"Maps To"})]}),j.map(e=>{let t=N.find(t=>t.sourceField===e),r=(null==t?void 0:t.targetField)||"",a=(null==t?void 0:t.required)||!1;return(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 p-4 border-b border-brand-600/10 last:border-b-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium text-text-primary",children:e}),a&&(0,s.jsx)("span",{className:"text-xs text-brand-950",children:"required"})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("select",{value:r,onChange:t=>O(e,t.target.value),className:"w-full px-3 py-1.5 rounded-lg bg-surface-secondary border border-surface-tertiary text-text-primary text-sm focus:border-brand-950 focus:ring-1 focus:ring-brand-950",children:[(0,s.jsx)("option",{value:"",children:"Skip"}),(0,s.jsx)("option",{value:"status",children:"Stage/Status"}),(0,s.jsx)("option",{value:"createdAt",children:"Date (Created)"}),(0,s.jsx)("option",{value:"updatedAt",children:"Date (Updated)"}),(0,s.jsx)("option",{value:"closedAt",children:"Date (Closed)"}),(0,s.jsx)("option",{value:"ownerId",children:"Owner/Person"}),(0,s.jsx)("option",{value:"value",children:"Value/Amount"})]})})]},e)})]}),!_()&&(0,s.jsxs)("div",{className:"mb-6 p-4 bg-surface-secondary border border-brand-600/20 rounded-lg flex items-start gap-3",children:[(0,s.jsx)(i.Z,{className:"w-5 h-5 text-brand-950 flex-shrink-0 mt-0.5"}),(0,s.jsx)("p",{className:"text-sm text-text-secondary",children:"Please map at least Stage/Status and Date fields to continue."})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("button",{onClick:()=>o("upload"),className:"flex items-center gap-2 px-4 py-2 text-text-secondary hover:text-text-primary transition-colors",children:[(0,s.jsx)(p,{className:"w-4 h-4"}),"Back"]}),(0,s.jsxs)("button",{onClick:()=>{sessionStorage.setItem("clarLensCSVData",JSON.stringify(y)),sessionStorage.setItem("clarLensMappings",JSON.stringify(N)),o("preview")},disabled:!_(),className:"flex items-center gap-2 px-6 py-3 bg-brand-950 text-surface font-medium rounded-lg hover:bg-brand-900 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Continue",(0,s.jsx)(h.Z,{className:"w-4 h-4"})]})]})]}),"preview"===r&&(0,s.jsxs)("div",{className:"animate-in",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Preview your data"}),(0,s.jsx)("p",{className:"text-text-secondary mb-8",children:"Review your data summary and sample rows before generating insights."}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[(0,s.jsxs)("div",{className:"p-4 bg-surface-secondary rounded-lg border border-surface-tertiary",children:[(0,s.jsx)("p",{className:"text-sm text-text-tertiary mb-1",children:"Total Rows"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-text-primary",children:y.length})]}),(0,s.jsxs)("div",{className:"p-4 bg-surface-secondary rounded-lg border border-surface-tertiary",children:[(0,s.jsx)("p",{className:"text-sm text-text-tertiary mb-1",children:"Date Range"}),(0,s.jsx)("p",{className:"text-lg font-semibold text-text-primary",children:(()=>{let e=N.find(e=>"createdAt"===e.targetField||"updatedAt"===e.targetField);if(!e)return"N/A";let t=y.map(t=>t[e.sourceField]).filter(Boolean);if(0===t.length)return"N/A";let r=t.sort();return"".concat(r[0]," - ").concat(r[r.length-1])})()})]}),(0,s.jsxs)("div",{className:"p-4 bg-surface-secondary rounded-lg border border-surface-tertiary",children:[(0,s.jsx)("p",{className:"text-sm text-text-tertiary mb-1",children:"Unique Owners"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-text-primary",children:(()=>{let e=N.find(e=>"ownerId"===e.targetField);return e&&new Set(y.map(t=>t[e.sourceField]).filter(Boolean)).size||"N/A"})()})]}),(0,s.jsxs)("div",{className:"p-4 bg-surface-secondary rounded-lg border border-surface-tertiary",children:[(0,s.jsx)("p",{className:"text-sm text-text-tertiary mb-1",children:"Unique Stages"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-text-primary",children:(()=>{let e=N.find(e=>"status"===e.targetField);return e&&new Set(y.map(t=>t[e.sourceField]).filter(Boolean)).size||"N/A"})()})]})]}),(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6 mb-8",children:[(0,s.jsx)("h3",{className:"font-semibold text-text-primary mb-4",children:"Sample Records (first 20)"}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{className:"text-left text-text-tertiary border-b border-brand-600/20",children:j.slice(0,6).map(e=>(0,s.jsx)("th",{className:"pb-2 pr-4",children:e},e))})}),(0,s.jsx)("tbody",{className:"text-text-secondary",children:y.slice(0,20).map((e,t)=>(0,s.jsx)("tr",{className:"border-b border-brand-600/10",children:j.slice(0,6).map(t=>(0,s.jsx)("td",{className:"py-2 pr-4",children:e[t]||"-"},t))},t))})]})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("button",{onClick:()=>o("map"),className:"flex items-center gap-2 px-4 py-2 text-text-secondary hover:text-text-primary transition-colors",children:[(0,s.jsx)(p,{className:"w-4 h-4"}),"Back"]}),(0,s.jsxs)("button",{onClick:()=>{e.push("/dashboard")},className:"flex items-center gap-2 px-6 py-3 bg-brand-950 text-surface font-medium rounded-lg hover:bg-brand-900 transition-colors",children:["Generate Dashboard",(0,s.jsx)(h.Z,{className:"w-4 h-4"})]})]})]})]})]})}function f(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-screen bg-surface flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(x,{className:"w-8 h-8 text-brand-950 animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-text-secondary",children:"Loading..."})]})}),children:(0,s.jsx)(b,{})})}}},function(e){e.O(0,[988,971,117,744],function(){return e(e.s=89571)}),_N_E=e.O()}]);