(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{87953:function(e,t,a){Promise.resolve().then(a.bind(a,43360))},43360:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return P}});var s=a(57437),r=a(2265),l=a(27648),i=a(82431),n=a(46221),d=a(31047),c=a(82023),o=a(70525),x=a(91723),m=a(47625),u=a(5481),g=a(56940),h=a(97059),f=a(62994),p=a(8147),b=a(22190),j=a(23263),y=a(21156),v=a(54061);function N(e){if(!e||""===e.trim())return null;let t=new Date(e);if(!isNaN(t.getTime()))return t;for(let t of[/(\d{4})-(\d{2})-(\d{2})/,/(\d{2})\/(\d{2})\/(\d{4})/,/(\d{2})-(\d{2})-(\d{4})/]){let a=e.match(t);if(a){if(/(\d{4})-(\d{2})-(\d{2})/===t)return new Date("".concat(a[1],"-").concat(a[2],"-").concat(a[3]));return new Date("".concat(a[3],"-").concat(a[2],"-").concat(a[1]))}}return null}function w(e){let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(s)}function F(e){let{csvData:t,mappings:a,type:l}=e,i=(0,r.useMemo)(()=>{if(0===t.length)return[];switch(l){case"velocity":return function(e,t){let a=t.find(e=>"createdAt"===e.targetField),s=t.find(e=>"status"===e.targetField);if(!a||!s)return[];let r=new Map;e.forEach(e=>{let t=e[a.sourceField],l=e[s.sourceField];if(!t||!l)return;let i=N(t);if(!i)return;let n=w(i);r.has(n)||r.set(n,new Map);let d=r.get(n);d.set(l,(d.get(l)||0)+1)});let l=new Set;r.forEach(e=>{e.forEach((e,t)=>l.add(t))});let i=[],n=Array.from(r.keys()).sort();return l.forEach(e=>{let t=n.map(t=>{var a;return{date:t,count:(null===(a=r.get(t))||void 0===a?void 0:a.get(e))||0}});i.push({stage:e,data:t})}),i}(t,a);case"distribution":return function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"createdAt",s=t.find(e=>e.targetField===a),r=t.find(e=>"status"===e.targetField);if(!s||!r)return[];let l=new Map;e.forEach(e=>{let t=e[s.sourceField],a=e[r.sourceField];if(!t||!a)return;let i=N(t);if(!i)return;let n=w(i);l.has(n)||l.set(n,new Map);let d=l.get(n);d.set(a,(d.get(a)||0)+1)});let i=new Set;l.forEach(e=>{e.forEach((e,t)=>i.add(t))});let n=[],d=Array.from(l.keys()).sort();return i.forEach(e=>{let t=d.map(t=>{var a;return{date:t,count:(null===(a=l.get(t))||void 0===a?void 0:a.get(e))||0}});n.push({stage:e,data:t})}),n}(t,a);case"winRate":return function(e,t){let a=t.find(e=>"createdAt"===e.targetField),s=t.find(e=>"status"===e.targetField);if(!a||!s)return[];let r=new Map;return e.forEach(e=>{let t=e[a.sourceField],l=e[s.sourceField];if(!t)return;let i=N(t);if(!i)return;let n=function(e){let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0");return"".concat(t,"-").concat(a)}(i);r.has(n)||r.set(n,{total:0,won:0});let d=r.get(n);d.total++,l&&l.toLowerCase().includes("closed")&&l.toLowerCase().includes("won")&&d.won++}),Array.from(r.keys()).sort().map(e=>{let t=r.get(e);return{date:e,count:t.total>0?t.won/t.total*100:0}})}(t,a);default:return[]}},[t,a,l]);if(0===i.length)return(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,s.jsx)(o.Z,{className:"w-5 h-5 text-brand-950"}),(0,s.jsxs)("h3",{className:"font-semibold text-text-primary",children:["velocity"===l&&"Deal Velocity Over Time","distribution"===l&&"Stage Distribution Over Time","winRate"===l&&"Win Rate Trend"]})]}),(0,s.jsx)("p",{className:"text-sm text-text-tertiary",children:"No time series data available. Make sure your CSV includes date fields."})]});let n=(0,r.useMemo)(()=>{if("winRate"===l)return i.map(e=>({date:e.date,"Win Rate %":e.count}));let e=new Map;return i.forEach(t=>{t.data.forEach(a=>{e.has(a.date)||e.set(a.date,{date:a.date}),e.get(a.date)[t.stage]=a.count})}),Array.from(e.values()).sort((e,t)=>String(e.date||"").localeCompare(String(t.date||"")))},[i,l]),d={prospecting:"#6a6a6a",qualification:"#7a7a7a",proposal:"#8a8a8a",negotiation:"#9a9a9a",closed_won:"#10b981","closed won":"#10b981"},c=e=>d[e.toLowerCase()]||"#aaaaaa",x=(0,r.useMemo)(()=>{if("winRate"===l)return[];let e=new Set;return i.forEach(t=>{e.add(t.stage)}),Array.from(e)},[i,l]);return(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,s.jsx)(o.Z,{className:"w-5 h-5 text-brand-950"}),(0,s.jsxs)("h3",{className:"font-semibold text-text-primary",children:["velocity"===l&&"Deal Velocity Over Time","distribution"===l&&"Stage Distribution Over Time","winRate"===l&&"Win Rate Trend"]})]}),(0,s.jsx)(m.h,{width:"100%",height:300,children:"distribution"===l?(0,s.jsxs)(u.T,{data:n,children:[(0,s.jsx)(g.q,{strokeDasharray:"3 3",stroke:"#333"}),(0,s.jsx)(h.K,{dataKey:"date",stroke:"#888",tick:{fill:"#888",fontSize:12}}),(0,s.jsx)(f.B,{stroke:"#888",tick:{fill:"#888",fontSize:12}}),(0,s.jsx)(p.u,{contentStyle:{backgroundColor:"#1a1a1a",border:"1px solid #333",borderRadius:"8px",color:"#fff"}}),(0,s.jsx)(b.D,{}),x.map(e=>(0,s.jsx)(j.u,{type:"monotone",dataKey:e,stackId:"1",stroke:c(e),fill:c(e),fillOpacity:.6},e))]}):(0,s.jsxs)(y.w,{data:n,children:[(0,s.jsx)(g.q,{strokeDasharray:"3 3",stroke:"#333"}),(0,s.jsx)(h.K,{dataKey:"date",stroke:"#888",tick:{fill:"#888",fontSize:12}}),(0,s.jsx)(f.B,{stroke:"#888",tick:{fill:"#888",fontSize:12}}),(0,s.jsx)(p.u,{contentStyle:{backgroundColor:"#1a1a1a",border:"1px solid #333",borderRadius:"8px",color:"#fff"}}),(0,s.jsx)(b.D,{}),"winRate"===l?(0,s.jsx)(v.x,{type:"monotone",dataKey:"Win Rate %",stroke:"#10b981",strokeWidth:2,dot:{fill:"#10b981",r:4}}):x.map(e=>(0,s.jsx)(v.x,{type:"monotone",dataKey:e,stroke:c(e),strokeWidth:2,dot:{fill:c(e),r:4}},e))]})})]})}var D=a(49474),S=a(92369);function R(e){if(!e||""===e.trim())return null;let t=new Date(e);return isNaN(t.getTime())?null:t}function k(e){let{csvData:t,mappings:a,sortBy:l="closedWon",limit:i=10}=e,n=(0,r.useMemo)(()=>[...function(e,t){let a=t.find(e=>"ownerId"===e.targetField),s=t.find(e=>"status"===e.targetField),r=t.find(e=>"value"===e.targetField),l=t.find(e=>"createdAt"===e.targetField),i=t.find(e=>"closedAt"===e.targetField);if(!a||!s)return[];let n=new Map;return e.forEach(e=>{let t=e[a.sourceField]||"unassigned",d=e[s.sourceField]||"",c=r?parseFloat(e[r.sourceField]||"0"):0;n.has(t)||n.set(t,{totalDeals:0,closedWon:0,totalValue:0,cycleTimes:[]});let o=n.get(t);if(o.totalDeals++,o.totalValue+=c,d.toLowerCase().includes("closed")&&d.toLowerCase().includes("won")&&(o.closedWon++,l&&i)){let t=R(e[l.sourceField]),a=R(e[i.sourceField]);if(t&&a){let e=Math.round((a.getTime()-t.getTime())/864e5);e>0&&o.cycleTimes.push(e)}}}),Array.from(n.entries()).map(e=>{let[t,a]=e,s=a.cycleTimes.length>0?Math.round(a.cycleTimes.reduce((e,t)=>e+t,0)/a.cycleTimes.length):null;return{ownerId:t,totalDeals:a.totalDeals,closedWon:a.closedWon,conversionRate:a.totalDeals>0?a.closedWon/a.totalDeals*100:0,totalValue:a.totalValue,avgDealSize:a.totalDeals>0?a.totalValue/a.totalDeals:0,avgCycleTime:s}}).sort((e,t)=>t.closedWon-e.closedWon)}(t,a)].sort((e,t)=>{switch(l){case"conversionRate":return t.conversionRate-e.conversionRate;case"totalValue":return t.totalValue-e.totalValue;case"avgDealSize":return t.avgDealSize-e.avgDealSize;default:return t.closedWon-e.closedWon}}).slice(0,i),[t,a,l,i]);if(0===n.length)return(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,s.jsx)(D.Z,{className:"w-5 h-5 text-brand-950"}),(0,s.jsx)("h3",{className:"font-semibold text-text-primary",children:"Rep Performance Leaderboard"})]}),(0,s.jsx)("p",{className:"text-sm text-text-tertiary",children:"No rep data available. Make sure your CSV includes owner/rep fields."})]});let d=e=>1===e?"#10b981":2===e?"#8b5cf6":3===e?"#f59e0b":"#6a6a6a";return(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(D.Z,{className:"w-5 h-5 text-brand-950"}),(0,s.jsx)("h3",{className:"font-semibold text-text-primary",children:"Rep Performance Leaderboard"})]})}),(0,s.jsx)("div",{className:"space-y-3",children:n.map((e,t)=>{let a=t+1;return(0,s.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-surface-tertiary/50 rounded-lg border border-surface-tertiary hover:bg-surface-tertiary transition-colors",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center font-bold text-sm flex-shrink-0",style:{backgroundColor:d(a)+"20",color:d(a)},children:a}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)(S.Z,{className:"w-4 h-4 text-text-tertiary"}),(0,s.jsx)("p",{className:"font-medium text-text-primary truncate",children:e.ownerId})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 text-xs text-text-tertiary",children:[(0,s.jsxs)("span",{children:[e.totalDeals," deals"]}),e.avgCycleTime&&(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(x.Z,{className:"w-3 h-3"}),e.avgCycleTime," days avg"]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-right",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"Closed Won"}),(0,s.jsx)("p",{className:"text-lg font-bold text-text-primary",children:e.closedWon})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"Conversion"}),(0,s.jsxs)("p",{className:"text-lg font-bold text-text-primary",children:[e.conversionRate.toFixed(1),"%"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"Total Value"}),(0,s.jsxs)("p",{className:"text-lg font-bold text-text-primary",children:["$",(e.totalValue/1e3).toFixed(1),"k"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"Avg Deal"}),(0,s.jsxs)("p",{className:"text-lg font-bold text-text-primary",children:["$",(e.avgDealSize/1e3).toFixed(1),"k"]})]})]})]},e.ownerId)})})]})}var C=a(77031),M=a(31699),A=a(20407),T=a(5019),Z=a(95252),E=a(33327),L=a(49322);function V(e,t){let a=Math.floor((e.length-1)*(t/100));return e[a]||0}function z(e){let{csvData:t,mappings:a}=e,[l,i]=(0,r.useState)(void 0),n=(0,r.useMemo)(()=>(function(e,t){let a=t.find(e=>"value"===e.targetField);if(!a)return[];let s=e.map(e=>parseFloat(e[a.sourceField]||"0")).filter(e=>e>0).sort((e,t)=>e-t);if(0===s.length)return[];let r=Math.min(...s),l=Math.max(...s),i=(l-r)/10,n=[];for(let e=0;e<10;e++){let t=r+e*i,a=9===e?l:r+(e+1)*i,d=s.filter(s=>9===e?s>=t&&s<=a:s>=t&&s<a).length;n.push({range:function(e,t){let a=e=>e>=1e6?"$".concat((e/1e6).toFixed(1),"M"):e>=1e3?"$".concat((e/1e3).toFixed(0),"k"):"$".concat(e.toFixed(0));return"".concat(a(e)," - ").concat(a(t))}(t,a),count:d,percentage:d/s.length*100})}return n})(t,a),[t,a]),d=(0,r.useMemo)(()=>(function(e,t){let a=t.find(e=>"value"===e.targetField),s=t.find(e=>"status"===e.targetField);if(!a||!s)return[];let r=new Map;e.forEach(e=>{let t=parseFloat(e[a.sourceField]||"0"),l=e[s.sourceField];t>0&&l&&(r.has(l)||r.set(l,[]),r.get(l).push(t))});let l=[];return r.forEach((e,t)=>{let a=[...e].sort((e,t)=>e-t),s=a.length;if(0===s)return;let r=a[0],i=a[s-1],n=function(e){let t=Math.floor(e.length/2);return e.length%2==0?(e[t-1]+e[t])/2:e[t]}(a),d=a.reduce((e,t)=>e+t,0)/s,c=V(a,25),o=V(a,75);l.push({stage:t,min:r,max:i,median:n,avg:d,q1:c,q3:o,count:s})}),l.sort((e,t)=>t.avg-e.avg)})(t,a),[t,a]),c=(0,r.useMemo)(()=>(function(e,t,a){let s=t.find(e=>"value"===e.targetField),r=t.find(e=>"status"===e.targetField),l=t.find(e=>"ownerId"===e.targetField),i=t.find(e=>"id"===e.targetField);if(!s||!r)return[];let n=a;if(!n){let t=e.map(e=>parseFloat(e[s.sourceField]||"0")).filter(e=>e>0).sort((e,t)=>t-e);if(0===t.length)return[];n=Math.max(t[Math.floor(.1*t.length)]||0,5e4)}let d=[];return e.forEach((e,t)=>{let a=parseFloat(e[s.sourceField]||"0");a>=n&&d.push({id:i&&e[i.sourceField]||"deal-".concat(t),ownerId:l&&e[l.sourceField]||"unassigned",stage:e[r.sourceField]||"unknown",value:a})}),d.sort((e,t)=>t.value-e.value)})(t,a,l),[t,a,l]),x=(0,r.useMemo)(()=>c.reduce((e,t)=>e+t.value,0),[c]);if(0===t.length)return(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,s.jsx)(Z.Z,{className:"w-5 h-5 text-brand-950"}),(0,s.jsx)("h3",{className:"font-semibold text-text-primary",children:"Deal Quality Metrics"})]}),(0,s.jsx)("p",{className:"text-sm text-text-tertiary",children:"No data available."})]});if(!a.some(e=>"value"===e.targetField))return(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,s.jsx)(Z.Z,{className:"w-5 h-5 text-brand-950"}),(0,s.jsx)("h3",{className:"font-semibold text-text-primary",children:"Deal Quality Metrics"})]}),(0,s.jsx)("p",{className:"text-sm text-text-tertiary",children:"No value field mapped. Map a value field to see deal quality metrics."})]});let u=d.map(e=>({stage:e.stage,min:e.min,q1:e.q1,median:e.median,q3:e.q3,max:e.max,avg:e.avg,count:e.count}));return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,s.jsx)(Z.Z,{className:"w-5 h-5 text-brand-950"}),(0,s.jsx)("h3",{className:"font-semibold text-text-primary",children:"Deal Size Distribution"})]}),n.length>0?(0,s.jsx)(m.h,{width:"100%",height:300,children:(0,s.jsxs)(C.v,{data:n,children:[(0,s.jsx)(g.q,{strokeDasharray:"3 3",stroke:"#333"}),(0,s.jsx)(h.K,{dataKey:"range",stroke:"#888",tick:{fill:"#888",fontSize:11},angle:-45,textAnchor:"end",height:80}),(0,s.jsx)(f.B,{stroke:"#888",tick:{fill:"#888",fontSize:12}}),(0,s.jsx)(p.u,{contentStyle:{backgroundColor:"#1a1a1a",border:"1px solid #333",borderRadius:"8px",color:"#fff"},formatter:e=>["".concat(e," deals"),"Count"]}),(0,s.jsx)(M.$,{dataKey:"count",fill:"#10b981",radius:[4,4,0,0],children:n.map((e,t)=>(0,s.jsx)(A.b,{fill:e.percentage>20?"#10b981":"#6a6a6a"},"cell-".concat(t)))})]})}):(0,s.jsx)("p",{className:"text-sm text-text-tertiary",children:"No deal value data available."})]}),(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,s.jsx)(o.Z,{className:"w-5 h-5 text-brand-950"}),(0,s.jsx)("h3",{className:"font-semibold text-text-primary",children:"Deal Size by Stage"})]}),u.length>0?(0,s.jsx)(m.h,{width:"100%",height:300,children:(0,s.jsxs)(T.c,{data:u,children:[(0,s.jsx)(g.q,{strokeDasharray:"3 3",stroke:"#333"}),(0,s.jsx)(h.K,{dataKey:"stage",stroke:"#888",tick:{fill:"#888",fontSize:11},angle:-45,textAnchor:"end",height:80}),(0,s.jsx)(f.B,{stroke:"#888",tick:{fill:"#888",fontSize:12},label:{value:"Deal Value ($)",angle:-90,position:"insideLeft",fill:"#888"}}),(0,s.jsx)(p.u,{contentStyle:{backgroundColor:"#1a1a1a",border:"1px solid #333",borderRadius:"8px",color:"#fff"},formatter:(e,t)=>"avg"===t?["$".concat(e.toLocaleString()),"Average"]:["$".concat(e.toLocaleString()),t]}),(0,s.jsx)(b.D,{}),(0,s.jsx)(M.$,{dataKey:"min",fill:"#4a4a4a",name:"Min"}),(0,s.jsx)(M.$,{dataKey:"q1",fill:"#6a6a6a",name:"Q1"}),(0,s.jsx)(M.$,{dataKey:"median",fill:"#10b981",name:"Median"}),(0,s.jsx)(M.$,{dataKey:"q3",fill:"#8a8a8a",name:"Q3"}),(0,s.jsx)(M.$,{dataKey:"max",fill:"#aaaaaa",name:"Max"}),(0,s.jsx)(v.x,{type:"monotone",dataKey:"avg",stroke:"#f59e0b",strokeWidth:2,name:"Average"})]})}):(0,s.jsx)("p",{className:"text-sm text-text-tertiary",children:"No stage data available."})]}),(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(E.Z,{className:"w-5 h-5 text-brand-950"}),(0,s.jsx)("h3",{className:"font-semibold text-text-primary",children:"High-Value Deals"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("label",{className:"text-xs text-text-tertiary",children:"Threshold:"}),(0,s.jsx)("input",{type:"number",value:l||"",onChange:e=>i(e.target.value?parseFloat(e.target.value):void 0),placeholder:"Auto (90th %ile)",className:"w-32 px-2 py-1 bg-surface-tertiary border border-surface-tertiary rounded text-text-primary text-sm"})]})]}),c.length>0?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[(0,s.jsxs)("div",{className:"bg-surface-tertiary/50 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"High-Value Deals"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-text-primary",children:c.length})]}),(0,s.jsxs)("div",{className:"bg-surface-tertiary/50 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"Total Value"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-text-primary",children:["$",(x/1e3).toFixed(0),"k"]})]}),(0,s.jsxs)("div",{className:"bg-surface-tertiary/50 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"Avg Deal Size"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-text-primary",children:["$",(x/c.length/1e3).toFixed(0),"k"]})]})]}),(0,s.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:c.slice(0,10).map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-surface-tertiary/50 rounded-lg border border-surface-tertiary",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-lg bg-brand-950/20 flex items-center justify-center text-xs font-bold text-brand-950",children:t+1}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-text-primary",children:e.ownerId}),(0,s.jsx)("p",{className:"text-xs text-text-tertiary",children:e.stage})]})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsxs)("p",{className:"text-lg font-bold text-text-primary",children:["$",(e.value/1e3).toFixed(0),"k"]})})]},e.id))})]}):(0,s.jsxs)("div",{className:"flex items-center gap-2 text-text-tertiary",children:[(0,s.jsx)(L.Z,{className:"w-4 h-4"}),(0,s.jsx)("p",{className:"text-sm",children:"No high-value deals found. Try lowering the threshold."})]})]})]})}function W(e){let t=Math.floor(e.length/2);return e.length%2==0?Math.round((e[t-1]+e[t])/2):e[t]}function $(e){if(!e||""===e.trim())return null;let t=new Date(e);return isNaN(t.getTime())?null:t}function K(e){let{csvData:t,mappings:a}=e,l=(0,r.useMemo)(()=>(function(e,t){let a=t.find(e=>"createdAt"===e.targetField),s=t.find(e=>"updatedAt"===e.targetField),r=t.find(e=>"status"===e.targetField);if(!a||!s||!r)return[];let l=new Map;e.forEach(e=>{let t=e[a.sourceField],i=e[s.sourceField],n=e[r.sourceField];if(!t||!i||!n)return;let d=$(t),c=$(i);if(!d||!c)return;let o=Math.round((c.getTime()-d.getTime())/864e5);o>0&&(l.has(n)||l.set(n,[]),l.get(n).push(o))});let i=[];return l.forEach((e,t)=>{let a;let s=[...e].sort((e,t)=>e-t),r=s.length;if(0===r)return;let l=Math.round(e.reduce((e,t)=>e+t,0)/r),n=W(s),d=s[0],c=s[r-1];a=l<7?"Deals typically move through ".concat(t," quickly (").concat(l," days avg)"):l<30?"Deals spend about ".concat(l," days in ").concat(t," on average"):"Deals tend to stay in ".concat(t," for ").concat(l," days - consider reviewing"),i.push({stage:t,avgDays:l,medianDays:n,minDays:d,maxDays:c,sampleSize:r,prediction:a})}),i.sort((e,t)=>{let a={prospecting:1,qualification:2,proposal:3,negotiation:4,closed_won:5,"closed won":5};return(a[e.stage.toLowerCase()]||99)-(a[t.stage.toLowerCase()]||99)})})(t,a),[t,a]),i=(0,r.useMemo)(()=>(function(e,t){let a=t.find(e=>"createdAt"===e.targetField),s=t.find(e=>"closedAt"===e.targetField),r=t.find(e=>"status"===e.targetField);if(!a||!s||!r)return null;let l=e.filter(e=>{let t=e[r.sourceField]||"";return t.toLowerCase().includes("closed")&&t.toLowerCase().includes("won")});if(0===l.length)return null;let i=[];if(l.forEach(e=>{let t=e[a.sourceField],r=e[s.sourceField];if(!t||!r)return;let l=$(t),n=$(r);if(!l||!n)return;let d=Math.round((n.getTime()-l.getTime())/864e5);d>0&&i.push(d)}),0===i.length)return null;let n=[...i].sort((e,t)=>e-t);return{avgDays:Math.round(i.reduce((e,t)=>e+t,0)/i.length),medianDays:W(n),minDays:n[0],maxDays:n[n.length-1],sampleSize:i.length}})(t,a),[t,a]);return 0!==l.length||i?(0,s.jsxs)("div",{className:"space-y-6",children:[i&&(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,s.jsx)(x.Z,{className:"w-5 h-5 text-brand-950"}),(0,s.jsx)("h3",{className:"font-semibold text-text-primary",children:"Time to Close"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"bg-surface-tertiary/50 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"Average"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-text-primary",children:[i.avgDays," days"]})]}),(0,s.jsxs)("div",{className:"bg-surface-tertiary/50 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"Median"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-text-primary",children:[i.medianDays," days"]})]}),(0,s.jsxs)("div",{className:"bg-surface-tertiary/50 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"Fastest"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-text-primary",children:[i.minDays," days"]})]}),(0,s.jsxs)("div",{className:"bg-surface-tertiary/50 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"Slowest"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-text-primary",children:[i.maxDays," days"]})]})]}),(0,s.jsxs)("p",{className:"text-xs text-text-tertiary mt-4",children:["Based on ",i.sampleSize," closed deals"]})]}),l.length>0&&(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,s.jsx)(o.Z,{className:"w-5 h-5 text-brand-950"}),(0,s.jsx)("h3",{className:"font-semibold text-text-primary",children:"Stage Duration Predictions"})]}),(0,s.jsx)("div",{className:"space-y-4",children:l.map(e=>{let t=e.avgDays>30;return(0,s.jsxs)("div",{className:"p-4 bg-surface-tertiary/50 rounded-lg border border-surface-tertiary",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-text-primary mb-1",children:e.stage}),e.prediction&&(0,s.jsx)("p",{className:"text-sm text-text-secondary",children:e.prediction})]}),t&&(0,s.jsx)(L.Z,{className:"w-5 h-5 text-yellow-500 flex-shrink-0"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-4 mt-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"Average"}),(0,s.jsxs)("p",{className:"text-lg font-bold text-text-primary",children:[e.avgDays," days"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"Median"}),(0,s.jsxs)("p",{className:"text-lg font-bold text-text-primary",children:[e.medianDays," days"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"Range"}),(0,s.jsxs)("p",{className:"text-lg font-bold text-text-primary",children:[e.minDays,"-",e.maxDays," days"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-text-tertiary mb-1",children:"Sample Size"}),(0,s.jsxs)("p",{className:"text-lg font-bold text-text-primary",children:[e.sampleSize," deals"]})]})]})]},e.stage)})})]})]}):(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,s.jsx)(x.Z,{className:"w-5 h-5 text-brand-950"}),(0,s.jsx)("h3",{className:"font-semibold text-text-primary",children:"Stage Duration Predictions"})]}),(0,s.jsx)("p",{className:"text-sm text-text-tertiary",children:"No duration data available. Make sure your CSV includes created_at and updated_at fields."})]})}var I=a(90740),_=a(32489),q=a(62720);function O(e){var t,a,l,i,n,c,o,x,m,u,g;let h;let{csvData:f,mappings:p,filters:b,onFiltersChange:j}=e,[y,v]=(0,r.useState)(!1),[N,w]=(0,r.useState)(b),F=function(e,t){let a=t.find(e=>"ownerId"===e.targetField),s=t.find(e=>"status"===e.targetField),r=t.find(e=>"value"===e.targetField),l=new Set,i=new Set,n=[];return e.forEach(e=>{if(a){let t=e[a.sourceField];t&&l.add(t)}if(s){let t=e[s.sourceField];t&&i.add(t)}if(r){let t=parseFloat(e[r.sourceField]||"0");t>0&&n.push(t)}}),{owners:Array.from(l).sort(),stages:Array.from(i).sort(),valueRange:{min:n.length>0?Math.min(...n):0,max:n.length>0?Math.max(...n):0}}}(f,p),D=(h=0,((null===(x=b.dateRange)||void 0===x?void 0:x.start)||(null===(m=b.dateRange)||void 0===m?void 0:m.end))&&h++,b.owners&&b.owners.length>0&&h++,b.stages&&b.stages.length>0&&h++,((null===(u=b.valueRange)||void 0===u?void 0:u.min)||(null===(g=b.valueRange)||void 0===g?void 0:g.max))&&h++,h);(0,r.useEffect)(()=>{w(b)},[b]);let R=p.some(e=>["createdAt","updatedAt","closedAt"].includes(e.targetField)),k=p.some(e=>"ownerId"===e.targetField),C=p.some(e=>"status"===e.targetField),M=p.some(e=>"value"===e.targetField);return(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("button",{onClick:()=>v(!y),className:"flex items-center gap-2 px-4 py-2 bg-surface-secondary border border-brand-600/20 rounded-lg hover:bg-surface-tertiary transition-colors",children:[(0,s.jsx)(I.Z,{className:"w-4 h-4 text-text-primary"}),(0,s.jsx)("span",{className:"text-sm font-medium text-text-primary",children:"Filters"}),D>0&&(0,s.jsx)("span",{className:"px-2 py-0.5 bg-brand-950 text-surface text-xs font-bold rounded-full",children:D})]}),y&&(0,s.jsxs)("div",{className:"mt-4 bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h3",{className:"font-semibold text-text-primary",children:"Filter Data"}),(0,s.jsx)("button",{onClick:()=>v(!1),className:"text-text-tertiary hover:text-text-primary",children:(0,s.jsx)(_.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[R&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-text-secondary mb-2",children:[(0,s.jsx)(d.Z,{className:"w-4 h-4"}),"Date Range"]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("select",{value:(null===(t=N.dateRange)||void 0===t?void 0:t.field)||"createdAt",onChange:e=>w({...N,dateRange:{...N.dateRange,field:e.target.value}}),className:"w-full px-3 py-2 bg-surface-tertiary border border-surface-tertiary rounded-lg text-text-primary text-sm",children:[(0,s.jsx)("option",{value:"createdAt",children:"Created Date"}),(0,s.jsx)("option",{value:"updatedAt",children:"Updated Date"}),(0,s.jsx)("option",{value:"closedAt",children:"Closed Date"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)("input",{type:"date",value:(null===(l=N.dateRange)||void 0===l?void 0:null===(a=l.start)||void 0===a?void 0:a.toISOString().split("T")[0])||"",onChange:e=>{var t;return w({...N,dateRange:{...N.dateRange,field:(null===(t=N.dateRange)||void 0===t?void 0:t.field)||"createdAt",start:e.target.value?new Date(e.target.value):void 0}})},className:"px-3 py-2 bg-surface-tertiary border border-surface-tertiary rounded-lg text-text-primary text-sm",placeholder:"Start date"}),(0,s.jsx)("input",{type:"date",value:(null===(n=N.dateRange)||void 0===n?void 0:null===(i=n.end)||void 0===i?void 0:i.toISOString().split("T")[0])||"",onChange:e=>{var t;return w({...N,dateRange:{...N.dateRange,field:(null===(t=N.dateRange)||void 0===t?void 0:t.field)||"createdAt",end:e.target.value?new Date(e.target.value):void 0}})},className:"px-3 py-2 bg-surface-tertiary border border-surface-tertiary rounded-lg text-text-primary text-sm",placeholder:"End date"})]})]})]}),k&&F.owners.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-text-secondary mb-2",children:[(0,s.jsx)(S.Z,{className:"w-4 h-4"}),"Owners (",F.owners.length,")"]}),(0,s.jsx)("select",{multiple:!0,value:N.owners||[],onChange:e=>{let t=Array.from(e.target.selectedOptions,e=>e.value);w({...N,owners:t.length>0?t:void 0})},className:"w-full px-3 py-2 bg-surface-tertiary border border-surface-tertiary rounded-lg text-text-primary text-sm min-h-[100px]",size:5,children:F.owners.map(e=>(0,s.jsx)("option",{value:e,children:e},e))}),(0,s.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:"Hold Cmd/Ctrl to select multiple"})]}),C&&F.stages.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-text-secondary mb-2",children:[(0,s.jsx)(q.Z,{className:"w-4 h-4"}),"Stages (",F.stages.length,")"]}),(0,s.jsx)("select",{multiple:!0,value:N.stages||[],onChange:e=>{let t=Array.from(e.target.selectedOptions,e=>e.value);w({...N,stages:t.length>0?t:void 0})},className:"w-full px-3 py-2 bg-surface-tertiary border border-surface-tertiary rounded-lg text-text-primary text-sm min-h-[100px]",size:5,children:F.stages.map(e=>(0,s.jsx)("option",{value:e,children:e},e))}),(0,s.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:"Hold Cmd/Ctrl to select multiple"})]}),M&&F.valueRange.max>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-text-secondary mb-2",children:[(0,s.jsx)(Z.Z,{className:"w-4 h-4"}),"Deal Value Range"]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)("input",{type:"number",value:(null===(c=N.valueRange)||void 0===c?void 0:c.min)||"",onChange:e=>w({...N,valueRange:{...N.valueRange,min:e.target.value?parseFloat(e.target.value):void 0}}),placeholder:"Min (".concat(B(F.valueRange.min),")"),className:"px-3 py-2 bg-surface-tertiary border border-surface-tertiary rounded-lg text-text-primary text-sm"}),(0,s.jsx)("input",{type:"number",value:(null===(o=N.valueRange)||void 0===o?void 0:o.max)||"",onChange:e=>w({...N,valueRange:{...N.valueRange,max:e.target.value?parseFloat(e.target.value):void 0}}),placeholder:"Max (".concat(B(F.valueRange.max),")"),className:"px-3 py-2 bg-surface-tertiary border border-surface-tertiary rounded-lg text-text-primary text-sm"})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-3 mt-6 pt-6 border-t border-surface-tertiary",children:[(0,s.jsx)("button",{onClick:()=>{let e={};w(e),j(e),v(!1)},className:"px-4 py-2 text-sm font-medium text-text-secondary hover:text-text-primary transition-colors",children:"Clear All"}),(0,s.jsx)("button",{onClick:()=>{j(N),v(!1)},className:"px-6 py-2 bg-brand-950 text-surface font-medium rounded-lg hover:bg-brand-900 transition-colors",children:"Apply Filters"})]})]})]})}function B(e){return e>=1e6?"$".concat((e/1e6).toFixed(1),"M"):e>=1e3?"$".concat((e/1e3).toFixed(0),"k"):"$".concat(e.toFixed(0))}function P(){let[e,t]=(0,r.useState)([]),[a,m]=(0,r.useState)([]),[u,g]=(0,r.useState)("all"),[h,f]=(0,r.useState)(!0),[p,b]=(0,r.useState)({}),j=(()=>{let t=function(e,t,a){let s=[...e];if(a.dateRange){let e=t.find(e=>e.targetField===a.dateRange.field);e&&(s=s.filter(t=>{let s=t[e.sourceField];if(!s)return!1;let r=function(e){if(!e||""===e.trim())return null;let t=new Date(e);return isNaN(t.getTime())?null:t}(s);return!!r&&(!a.dateRange.start||!(r<a.dateRange.start))&&(!a.dateRange.end||!(r>a.dateRange.end))}))}if(a.owners&&a.owners.length>0){let e=t.find(e=>"ownerId"===e.targetField);e&&(s=s.filter(t=>{let s=t[e.sourceField]||"";return a.owners.includes(s)}))}if(a.stages&&a.stages.length>0){let e=t.find(e=>"status"===e.targetField);e&&(s=s.filter(t=>{let s=t[e.sourceField]||"";return a.stages.includes(s)}))}if(a.valueRange){let e=t.find(e=>"value"===e.targetField);e&&(s=s.filter(t=>{let s=parseFloat(t[e.sourceField]||"0");return(void 0===a.valueRange.min||!(s<a.valueRange.min))&&(void 0===a.valueRange.max||!(s>a.valueRange.max))}))}return s}(e,a,p);if("all"!==u){let e=a.find(e=>"createdAt"===e.targetField);if(e&&t.length>0){let a=parseInt(u),s=new Date;s.setDate(s.getDate()-a);let r=t.filter(t=>{let a=t[e.sourceField];if(!a)return!0;let r=new Date(a);return isNaN(r.getTime())||r>=s});r.length>0&&(t=r)}}return t})();(0,r.useEffect)(()=>{let e=sessionStorage.getItem("clarLensCSVData"),a=sessionStorage.getItem("clarLensMappings");e&&a&&(t(JSON.parse(e)),m(JSON.parse(a))),f(!1)},[]);let y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=a.find(e=>"status"===e.targetField);if(!t)return[];let s={};e.forEach(e=>{let a=e[t.sourceField];if(a){let e=a.toLowerCase().trim().replace(/\s+/g,"_");s[e]=(s[e]||0)+1}});let r=["prospecting","qualification","discovery","proposal","negotiation","closed_won","closed_lost"],l=r.filter(e=>s[e]>0),i=Object.keys(s).filter(e=>!r.includes(e)).sort((e,t)=>s[t]-s[e]),n=l.findIndex(e=>e.startsWith("closed")),d=(n>=0?[...l.slice(0,n),...i,...l.slice(n)]:[...l,...i]).filter(e=>"closed_lost"!==e),c=e.length;if(0===c||0===d.length)return[];let o=[];return d.forEach((e,t)=>{let a=s[e],r=d.slice(t).reduce((e,t)=>e+s[t],0);if(0===t)o.push({stage:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),count:a,conversionRate:100,dropoffRate:0});else{let l=d.slice(t-1).reduce((e,t)=>e+s[t],0);o.push({stage:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),count:a,conversionRate:c>0?r/c*100:0,dropoffRate:l>0?(l-r)/l*100:0})}}),o},v=y(),N=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=a.find(e=>"value"===e.targetField);return t?e.reduce((e,a)=>{let s=parseFloat(a[t.sourceField]||"0");return e+(isNaN(s)?0:s)},0):0}(),w=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=a.find(e=>"createdAt"===e.targetField),s=a.find(e=>"closedAt"===e.targetField);if(!t||!s)return null;let r=e.filter(e=>{let t=e[s.sourceField];return t&&""!==t.trim()});return 0===r.length?null:Math.round(r.reduce((e,a)=>{let r=new Date(a[t.sourceField]),l=new Date(a[s.sourceField]);return isNaN(r.getTime())||isNaN(l.getTime())?e:e+(l.getTime()-r.getTime())/864e5},0)/r.length)}(),D=j.length,S=v.find(e=>e.stage.toLowerCase().includes("closed won")||e.stage.toLowerCase().includes("closed_won")),R=S?(S.count/D*100).toFixed(1):v.length>0?(v[v.length-1].count/D*100).toFixed(1):"0",C=(()=>{let e=y();if(e.length<2)return"";let t=0,a="";for(let s=1;s<e.length;s++)e[s].dropoffRate>t&&(t=e[s].dropoffRate,a="".concat(e[s-1].stage," â†’ ").concat(e[s].stage));return t>0?"Biggest drop-off is ".concat(Math.round(t),"% between ").concat(a):""})();return h?(0,s.jsx)("div",{className:"min-h-screen bg-surface flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(i.Z,{className:"w-8 h-8 text-brand-950 animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-text-secondary",children:"Loading dashboard..."})]})}):0===e.length?(0,s.jsx)("div",{className:"min-h-screen bg-surface flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center max-w-md",children:[(0,s.jsx)(n.Z,{className:"w-12 h-12 text-text-tertiary mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"No data loaded"}),(0,s.jsx)("p",{className:"text-text-secondary mb-6",children:"Upload a CSV file to generate insights."}),(0,s.jsx)(l.default,{href:"/onboarding",className:"inline-flex items-center gap-2 px-6 py-3 bg-brand-950 text-surface font-medium rounded-lg hover:bg-brand-900 transition-colors",children:"Upload CSV"})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-surface",children:[(0,s.jsx)("header",{className:"border-b border-surface-tertiary bg-surface-secondary",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-6 h-16 flex items-center justify-between",children:[(0,s.jsxs)(l.default,{href:"/",className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-lg bg-brand-950 flex items-center justify-center",children:(0,s.jsx)(n.Z,{className:"w-5 h-5 text-surface"})}),(0,s.jsx)("span",{className:"font-semibold text-lg text-text-primary",children:"ClarLens"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-surface-tertiary rounded-lg border border-surface-tertiary",children:[(0,s.jsx)(d.Z,{className:"w-4 h-4 text-text-tertiary"}),(0,s.jsxs)("select",{value:u,onChange:e=>g(e.target.value),className:"bg-transparent text-text-primary text-sm border-none outline-none cursor-pointer",children:[(0,s.jsx)("option",{value:"all",children:"All time"}),(0,s.jsx)("option",{value:"90",children:"Last 90 days"}),(0,s.jsx)("option",{value:"30",children:"Last 30 days"})]})]}),(0,s.jsx)(l.default,{href:"/onboarding",className:"px-4 py-2 bg-surface-tertiary text-text-primary text-sm font-medium rounded-lg hover:bg-surface-secondary transition-colors border border-surface-tertiary",children:"Upload New CSV"})]})]})}),C&&(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-6 pt-6",children:(0,s.jsxs)("div",{className:"bg-surface-secondary border border-brand-600/30 rounded-lg p-4 flex items-start gap-3",children:[(0,s.jsx)(c.Z,{className:"w-5 h-5 text-brand-950 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-text-primary",children:C}),(0,s.jsxs)("p",{className:"text-sm text-text-tertiary mt-1",children:["Based on analysis of ",D," records"]})]})]})}),(0,s.jsxs)("main",{className:"max-w-7xl mx-auto px-6 py-8",children:[(0,s.jsx)(O,{csvData:e,mappings:a,filters:p,onFiltersChange:b}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)(n.Z,{className:"w-5 h-5 text-brand-950"})}),(0,s.jsx)("p",{className:"text-sm text-text-tertiary mb-1",children:"Total Records"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-text-primary",children:D.toLocaleString()})]}),(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)(o.Z,{className:"w-5 h-5 text-brand-950"})}),(0,s.jsx)("p",{className:"text-sm text-text-tertiary mb-1",children:"Conversion Rate"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-text-primary",children:[R,"%"]})]}),N>0&&(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)(o.Z,{className:"w-5 h-5 text-brand-950"})}),(0,s.jsx)("p",{className:"text-sm text-text-tertiary mb-1",children:"Total Value"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-text-primary",children:["$",N.toLocaleString(void 0,{maximumFractionDigits:0})]})]}),null!==w&&(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)(x.Z,{className:"w-5 h-5 text-brand-950"})}),(0,s.jsx)("p",{className:"text-sm text-text-tertiary mb-1",children:"Avg Cycle Time"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-text-primary",children:[w," days"]})]})]}),(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6 mb-8",children:[(0,s.jsx)("h3",{className:"font-semibold text-text-primary mb-6",children:"Pipeline Funnel"}),(0,s.jsx)("div",{className:"space-y-3",children:v.map((e,t)=>{let a=v.slice(t).reduce((e,t)=>e+t.count,0),r=a/D*100,l=t===v.length-1,i=["#4a4a4a","#5a5a5a","#6a6a6a","#7a7a7a","#8a8a8a"];return(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"w-36 text-sm text-text-secondary font-medium",children:e.stage}),(0,s.jsx)("div",{className:"flex-1 relative",children:(0,s.jsx)("div",{className:"h-12 bg-surface-tertiary rounded-lg overflow-hidden relative",children:(0,s.jsx)("div",{className:"h-full rounded-lg transition-all duration-500 flex items-center justify-end pr-3",style:{width:"".concat(r,"%"),backgroundColor:l?"#10b981":i[Math.min(t,i.length-1)]},children:(0,s.jsx)("span",{className:"text-xs font-semibold text-white",children:a})})})}),(0,s.jsxs)("div",{className:"w-24 text-right",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-text-primary",children:e.count}),t>0&&(0,s.jsxs)("div",{className:"text-xs text-text-tertiary",children:[e.conversionRate.toFixed(1),"% conversion"]})]})]},e.stage)})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[(0,s.jsx)(F,{csvData:j,mappings:a,type:"velocity"}),(0,s.jsx)(F,{csvData:j,mappings:a,type:"winRate"})]}),(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)(F,{csvData:j,mappings:a,type:"distribution"})}),(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)(K,{csvData:j,mappings:a})}),(0,s.jsxs)("div",{className:"bg-surface-secondary rounded-lg border border-brand-600/20 p-6",children:[(0,s.jsx)("h3",{className:"font-semibold text-text-primary mb-4",children:"Stage Metrics"}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left text-text-tertiary border-b border-surface-tertiary",children:[(0,s.jsx)("th",{className:"pb-2 pr-4",children:"Stage"}),(0,s.jsx)("th",{className:"pb-2 pr-4 text-right",children:"Count"}),(0,s.jsx)("th",{className:"pb-2 pr-4 text-right",children:"Conversion Rate"}),(0,s.jsx)("th",{className:"pb-2 pr-4 text-right",children:"Drop-off Rate"})]})}),(0,s.jsx)("tbody",{className:"text-text-secondary",children:v.map((e,t)=>(0,s.jsxs)("tr",{className:"border-b border-surface-tertiary",children:[(0,s.jsx)("td",{className:"py-3 pr-4 font-medium text-text-primary",children:e.stage}),(0,s.jsx)("td",{className:"py-3 pr-4 text-right",children:e.count}),(0,s.jsx)("td",{className:"py-3 pr-4 text-right",children:t>0?"".concat(e.conversionRate.toFixed(1),"%"):"-"}),(0,s.jsx)("td",{className:"py-3 pr-4 text-right",children:t>0?"".concat(e.dropoffRate.toFixed(1),"%"):"-"})]},e.stage))})]})})]}),j.length>0&&a.some(e=>"ownerId"===e.targetField)&&(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)(k,{csvData:j,mappings:a,sortBy:"closedWon",limit:10})}),j.length>0&&a.some(e=>"value"===e.targetField)&&(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)(z,{csvData:j,mappings:a})})]})]})}}},function(e){e.O(0,[988,879,971,117,744],function(){return e(e.s=87953)}),_N_E=e.O()}]);